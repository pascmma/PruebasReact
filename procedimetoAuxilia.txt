8:20 - 11:00 estadisticas 
DECLARE @socio char(5),@meses int

DECLARE @FechaQuiebre date 
DECLARE @FechaReporte date

-- 27567
set @socio = '05222' 
set @FechaQuiebre ='20131101'
set @FechaReporte='20211130'


/*
select case when DEUDA > 500 then DEUDA-500 else DEUDA end as 'dude' FROM REST_Cuotas
 where TIPO='AS' and ESTADO='AC' and ANO='2021' and MES='11' 
*/

select
@socio as 'NumSocio',
 ClubInter.dbo.FSOCCON_FechaInicioConteo(@socio) AS 'FechaInicioConteo',
 
 DATEADD(mm,360, ClubInter.dbo.FSOCCON_FechaInicioConteo(@socio)) AS 'FechaVitalicio', -- suma de los 30 años para ver si es socio vitalicio,
 
 dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte) as 'MesesAnteriores',
 
 dbo.fn_getNumMesesCasAct(@socio,@FechaReporte) as 'MesesActuales',
 
 
 case when dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte) >= 360 THEN (dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte)+ dbo.fn_getNumMesesCasAct(@socio, @FechaReporte)-360) else  
 case when (dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte)+ dbo.fn_getNumMesesCasAct(@socio, @FechaReporte ))>= 360 then (dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte)+ dbo.fn_getNumMesesCasAct(@socio, @FechaReporte ) - 360) else 0 end  end as 'MesesNoPagara',
 
 dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte)+ dbo.fn_getNumMesesCasAct(@socio, @FechaReporte)as 'MesesTotales',
 
 case when dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte) >= 360 THEN (select DEUDA FROM REST_Cuotas  where SOCIO = @socio and ANO='2021' and MES='11' and TIPO='AS' and ESTADO='AC' )- (dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte)+ dbo.fn_getNumMesesCasAct(@socio, @FechaReporte)-360)*32.5 else  -- modificar aqui
 case when (dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte)+ dbo.fn_getNumMesesCasAct(@socio, @FechaReporte ))>= 360 then (select DEUDA FROM REST_Cuotas  where SOCIO = @socio and ANO='2021' and MES='11' and TIPO='AS' and ESTADO='AC' )  - (dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte)+ dbo.fn_getNumMesesCasAct(@socio, @FechaReporte ) - 360)*32.5 else (select DEUDA FROM REST_Cuotas  where SOCIO = @socio and ANO='2021' and MES='11' and TIPO='AS' and ESTADO='AC' )end end as 'DeudaNueva',
 
 (select DEUDA FROM REST_Cuotas  where SOCIO = @socio and ANO='2021' and MES='11' and TIPO='AS' and ESTADO='AC' ) as 'DeudaOriginal',
 DATEDIFF(mm,ClubInter.dbo.FSOCCON_FechaInicioConteo(@socio),@FechaQuiebre) as 'MesesAntesFechaQuiebre'
 
 
 
 
 
 

 select 
 @socio as 'NumSocio',
 
 ClubInter.dbo.FSOCCON_FechaInicioConteo(@socio) AS 'FechaInicioConteo',
 
 DATEADD(mm,360, ClubInter.dbo.FSOCCON_FechaInicioConteo(@socio)) AS 'FechaVitalicio', -- suma de los 30 años para ver si es socio vitalicio,
 
 dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte) as 'MesesAnteriores',
 
 dbo.fn_getNumMesesCasAct(@socio,@FechaReporte) as 'MesesActuales',
 case when DATEADD(mm,360, ClubInter.dbo.FSOCCON_FechaInicioConteo(@socio)) < @FechaQuiebre then  (select DEUDA FROM REST_Cuotas  where SOCIO = @socio and ANO='2021' and MES='11' and TIPO='AS' and ESTADO='AC' )- (((dbo.fn_getNumMesesCuotaAnt(@socio,@FechaReporte)+ dbo.fn_getNumMesesCasAct(@socio, @FechaReporte ) - 360) * 17.70)+ dbo.fn_getNumMesesCasAct(@socio,@FechaReporte)*32.50 ) else 
 DATEDIFF(mm,ClubInter.dbo.FSOCCON_FechaInicioConteo(@socio),@FechaQuiebre) * 17.70 + 
 end as 'DeudaNuevaFinal'










 select 
 cuo.SOCIO as 'NumSocio',
 
 ClubInter.dbo.FSOCCON_FechaInicioConteo(@socio) AS 'FechaInicioConteo',
 
 DATEADD(mm,360, ClubInter.dbo.FSOCCON_FechaInicioConteo(cuo.SOCIO)) AS 'FechaVitalicio', -- suma de los 30 años para ver si es socio vitalicio,
 
 dbo.fn_getNumMesesCuotaAnt(cuo.SOCIO,@FechaReporte) as 'MesesAnteriores',
 case when DATEADD(mm,360, ClubInter.dbo.FSOCCON_FechaInicioConteo(cuo.SOCIO)) < @FechaQuiebre then 1 else 0 end as 'bool', 
  ((dbo.fn_getNumMesesCuotaAnt(cuo.SOCIO,@FechaReporte)+ dbo.fn_getNumMesesCasAct(cuo.SOCIO, @FechaReporte)) - DATEDIFF(mm,ClubInter.dbo.FSOCCON_FechaInicioConteo(cuo.SOCIO),@FechaQuiebre)) as 'mesesdiferencia',
 dbo.fn_getNumMesesCasAct(cuo.SOCIO,@FechaReporte) as 'MesesActuales',
 case when (DATEADD(mm,360, ClubInter.dbo.FSOCCON_FechaInicioConteo(cuo.SOCIO)) < @FechaQuiebre and (dbo.fn_getNumMesesCuotaAnt(cuo.SOCIO,@FechaReporte)> 360)) then  6372 else 
 case when(DATEADD(mm,360, ClubInter.dbo.FSOCCON_FechaInicioConteo(cuo.SOCIO)) >= @FechaQuiebre and (dbo.fn_getNumMesesCuotaAnt(cuo.SOCIO,@FechaReporte)> 360)) then (DATEDIFF(mm,ClubInter.dbo.FSOCCON_FechaInicioConteo(cuo.SOCIO),@FechaQuiebre) * 17.70) + ((dbo.fn_getNumMesesCuotaAnt(cuo.SOCIO,@FechaReporte)+ dbo.fn_getNumMesesCasAct(cuo.SOCIO, @FechaReporte)) - DATEDIFF(mm,ClubInter.dbo.FSOCCON_FechaInicioConteo(@socio),@FechaQuiebre))*32.50 end
 end as 'DeudaNuevaFinal'
 from REST_Cuotas as cuo
 where ANO='2021' and MES='11' and TIPO='AS' and ESTADO='AC'







declare @test int

select * from REST_Cuotas where ANO='2021' and MES='11' and TIPO='AS' and ESTADO='AC'

order by FIRSTCUOTA



prodedure REST_getDeudasCuotas






 